<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Gifts Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0; /* –£–±—Ä–∞–ª –ª–∏—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
        }

        /* –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ö–µ–¥–µ—Ä–µ –¥–ª—è –ª—É—á—à–µ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è */
        .header-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
            font-size: 0.9em;
            opacity: 0.7;
            text-align: right;
        }

        .last-update { /* –û—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –±—ã–ª–æ –≤ –≤–∞—à–µ–º CSS */
            font-size: 14px;
            opacity: 0.8;
            color: #4ecdc4;
        }

        /* –ù–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π */
        .total-models-count {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 3px;
        }

        .controls {
            padding: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .time-filter-group {
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 25px;
            padding: 5px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .time-filter-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .time-filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .time-filter-btn.active {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .filter-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .collections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .collection-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
            text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        }

        .collection-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .collection-header {
            display: flex;
            flex-direction: column; /* –≠–ª–µ–º–µ–Ω—Ç—ã –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –±—É–¥—É—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
            gap: 12px;
            margin-bottom: 15px;
            width: 100%;
        }

        .collection-image { /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ */
            width: 80px; /* –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
            height: 80px;
            border-radius: 12px; /* –ß—É—Ç—å —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã */
            object-fit: cover;
            margin-bottom: 10px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            border: 2px solid #4ecdc4; /* –†–∞–º–∫–∞ */
        }

        .collection-emoji {
            font-size: 32px;
            /* margin-bottom: 5px; –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –æ—Ç—Å—Ç—É–ø */
        }

        .collection-name {
            font-size: 20px;
            font-weight: 600;
        }

        .collection-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            width: 100%; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É */
            font-size: 1.1em;
            font-weight: 500;
        }

        .price {
            font-size: 18px;
            font-weight: 700;
            color: #4ecdc4;
        }
        .model-card .price { /* –£—Ç–æ—á–Ω–µ–Ω–∏–µ –¥–ª—è —Ü–µ–Ω—ã –≤ –º–æ–¥–µ–ª—è—Ö */
            font-size: 1.2em; /* –ù–µ–º–Ω–æ–≥–æ –∫—Ä—É–ø–Ω–µ–µ –¥–ª—è –º–æ–¥–µ–ª–µ–π */
            font-weight: 700;
        }

        .change {
            font-size: 16px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .change.positive {
            color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .change.negative {
            color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
        }

        .change.neutral {
            color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .time-period-label {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
        }

        .models-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .model-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column; /* –≠–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—Ç—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
            text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç */
        }

        .model-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.02);
        }

        .model-image {
            width: 100%; /* –ú–µ–Ω—è–µ–º –Ω–∞ 100% —à–∏—Ä–∏–Ω—ã —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ */
            height: 150px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–æ–¥–µ–ª–µ–π */
            object-fit: cover; /* –û–±—Ä–µ–∑–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –æ–Ω–æ –∑–∞–ø–æ–ª–Ω–∏–ª–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
            border-radius: 8px; /* –ù–µ–º–Ω–æ–≥–æ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã */
            margin-bottom: 10px;
            border: 2px solid #4ecdc4;
        }

        .model-header {
            display: flex;
            flex-direction: column; /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–µ–ª–∏ —Ç–∞–∫–∂–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
            justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º, –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ */
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
            margin-bottom: 10px;
            width: 100%;
        }

        .model-name {
            font-size: 18px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
            font-weight: 600;
            margin-bottom: 5px; /* –ù–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –æ—Ç —Ü–µ–Ω—ã, –µ—Å–ª–∏ –æ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ */
        }

        .model-stats {
            display: flex;
            justify-content: space-between;
            align-items: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ —Ü–µ–Ω—Ç—Ä—É –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
            font-size: 14px;
            opacity: 0.8;
            width: 100%; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É */
            margin-top: auto; /* –ü—Ä–∏–∂–∏–º–∞–µ—Ç –∫ –Ω–∏–∑—É, –µ—Å–ª–∏ flex-direction: column */
        }
        .model-stats span { /* –î–æ–±–∞–≤–∏–ª –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ */
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center; /* –î–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ */
            align-items: center; /* –î–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ */
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative; /* –ß—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –±—ã–ª–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ */
            animation: fadeIn 0.3s ease-out; /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
            display: flex; /* –î–ª—è –∫–æ–º–ø–æ–Ω–æ–≤–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –º–æ–¥–∞–ª–∫–∏ */
            flex-direction: column;
        }

        @keyframes fadeIn { /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between; /* –û—Å—Ç–∞–≤–ª–µ–Ω–æ space-between –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è */
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap; /* –î–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        }
        .modal-header h2 { /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –º–æ–¥–∞–ª–∫–∏ */
            font-size: 1.8em;
            color: #4ecdc4; /* –¶–≤–µ—Ç –∫–∞–∫ –¥–ª—è —Ü–µ–Ω */
            flex-grow: 1; /* –ß—Ç–æ–±—ã –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–Ω–∏–º–∞–ª –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
        }

        .close { /* –í–∞—à –∫–ª–∞—Å—Å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è */
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover, .close:focus {
            color: #fff;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            width: 100%;
            height: 300px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
            position: relative;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* –ò–∑–º–µ–Ω–µ–Ω–æ –¥–ª—è –ª—É—á—à–µ–π –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
            gap: 15px;
            margin: 20px 0;
            text-align: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            /* –¶–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–ª–∞—Å—Å–∞–º–∏ –Ω–∏–∂–µ */
            color: white;
        }
        /* –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª–∞—Å—Å—ã –¥–ª—è —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ */
        .stat-value.positive { color: #00ff88; }
        .stat-value.negative { color: #ff4757; }
        .stat-value.neutral { color: #ffd700; } /* –ñ–µ–ª—Ç—ã–π –¥–ª—è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è */


        .stat-label {
            font-size: 14px;
            opacity: 0.7;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-bottom: 20px;
            display: none;
            transition: all 0.3s ease; /* –î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –Ω–∞–≤–µ–¥–µ–Ω–∏—è */
            font-size: 0.9em;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            opacity: 0.7;
        }

        .search-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 10px 15px;
            color: white;
            width: 250px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        .search-box:focus { /* –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ */
            border-color: #667eea;
            outline: none;
        }

        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .analytics-summary {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ 150px min-width */
            gap: 15px;
            text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤–Ω—É—Ç—Ä–∏ */
        }
        .analytics-summary .stat-card { /* –£—Ç–æ—á–Ω–µ–Ω–∏–µ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–Ω—É—Ç—Ä–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ */
            padding: 10px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .error-message {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid #ff4757;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            color: #ff4757;
            margin: 20px 0;
        }

        .refresh-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        /* --- –ê–î–ê–ü–¢–ò–í–ù–´–ï –°–¢–ò–õ–ò (–ú–û–ë–ò–õ–¨–ù–´–ï) --- */
        @media (max-width: 768px) {
            .container {
                padding: 10px; /* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –ø–æ –∫—Ä–∞—è–º */
            }

            .collections-grid,
            .models-list {
                grid-template-columns: 1fr; /* –û–î–ù–ê –ö–û–õ–û–ù–ö–ê –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
                gap: 15px; /* –û—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ */
            }

            .collection-card,
            .model-card {
                padding: 15px; /* –£–º–µ–Ω—å—à–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã –∫–∞—Ä—Ç–æ—á–µ–∫ */
                flex-direction: column; /* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
                align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
                text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç */
                width: 95%; /* –î–µ–ª–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —á—É—Ç—å –º–µ–Ω—å—à–µ, —á–µ–º 100%, –¥–ª—è –æ—Ç—Å—Ç—É–ø–æ–≤ –æ—Ç –∫—Ä–∞—è */
                margin: 0 auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫—É */
            }

            .collection-image {
                width: 90px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ */
                height: 90px;
                border-radius: 12px; /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –∑–∞–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–º–∏ —É–≥–ª–∞–º–∏ */
                margin-bottom: 15px; /* –£–≤–µ–ª–∏—á–∏–ª –æ—Ç—Å—Ç—É–ø */
            }

            .collection-emoji {
                font-size: 40px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä —ç–º–æ–¥–∑–∏ */
                margin-bottom: 5px; /* –ù–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø */
            }

            .collection-name {
                font-size: 22px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ */
            }

            .model-image {
                width: 100%; /* –ö–∞—Ä—Ç–∏–Ω–∫–∞ –º–æ–¥–µ–ª–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é —à–∏—Ä–∏–Ω—É */
                height: 200px; /* –£–≤–µ–ª–∏—á–∏–ª –≤—ã—Å–æ—Ç—É –¥–ª—è –º–æ–¥–µ–ª–µ–π */
                border-radius: 8px;
                margin-bottom: 15px; /* –û—Ç—Å—Ç—É–ø –æ—Ç –Ω–∏–∂–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            }

            .model-name {
                font-size: 20px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä –Ω–∞–∑–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ */
            }

            .model-header {
                 flex-direction: column; /* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–µ–ª–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
                 align-items: center;
                 justify-content: center;
                 margin-bottom: 10px;
                 width: 100%;
            }

            .price {
                font-size: 20px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä —Ü–µ–Ω—ã */
            }

            .change {
                font-size: 18px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è */
                padding: 6px 12px;
            }

            .model-stats, .collection-stats {
                flex-direction: row; /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —ç—Ç–∏ –±–ª–æ–∫–∏ –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ —Å—Ç—Ä–æ–∫—É */
                justify-content: space-around; /* –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
                width: 100%; /* –ó–∞–Ω–∏–º–∞—é—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É */
                margin-bottom: 10px; /* –û—Ç—Å—Ç—É–ø */
            }


            .controls {
                padding: 15px 10px;
                flex-direction: column; /* –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—Ç—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
                gap: 10px; /* –£–º–µ–Ω—å—à–∞–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ */
            }
            .time-filter-group, .filter-group {
                flex-wrap: wrap;
                width: 100%; /* –ó–∞–Ω–∏–º–∞—é—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É */
                justify-content: center;
                gap: 5px; /* –£–º–µ–Ω—å—à–∞–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø—ã */
            }
            .time-filter-btn, .filter-btn {
                padding: 10px 15px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º padding –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –Ω–∞–∂–∞—Ç–∏—è */
                font-size: 16px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∫–Ω–æ–ø–æ–∫ */
            }

            .modal-content {
                padding: 20px;
                width: 95%; /* –®–∏—Ä–∏–Ω–∞ –º–æ–¥–∞–ª–∫–∏ */
                margin: auto 10px; /* –û—Ç—Å—Ç—É–ø—ã –ø–æ –±–æ–∫–∞–º */
            }

            .modal-header {
                flex-direction: column; /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª–∫–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
                text-align: center;
                margin-bottom: 15px;
            }
            .modal-header h2 {
                font-size: 1.5em; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –º–æ–¥–∞–ª–∫–∏ */
                margin-bottom: 10px; /* –û—Ç—Å—Ç—É–ø –æ—Ç –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è */
            }
            .close {
                font-size: 32px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è */
            }

            .header { /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —à–∞–ø–∫–∏ */
                flex-direction: column;
                align-items: flex-start;
                padding: 10px 15px;
            }
            .header .header-info {
                align-items: flex-start;
                margin-top: 10px;
                width: 100%; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É */
            }
            .analytics-summary, .stats-grid { /* –î–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –º–æ–¥–∞–ª–∫–∏ */
                grid-template-columns: 1fr;
                gap: 10px; /* –£–º–µ–Ω—å—à–∞–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ */
                padding: 15px; /* –£–º–µ–Ω—å—à–∞–µ–º padding */
            }
            .search-box {
                width: 100%; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
                margin-top: 10px; /* –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéÅ Telegram Gifts Tracker</h1>
        <div class="header-info"> <div class="last-update" id="lastUpdate">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="total-models-count" id="totalModelsCount">–í—Å–µ–≥–æ –º–æ–¥–µ–ª–µ–π: 0</div>
        </div>
    </div>

    <div class="controls">
        <div class="time-filter-group">
            <button class="time-filter-btn active" data-period="1h">1 —á–∞—Å</button>
            <button class="time-filter-btn" data-period="24h">24 —á–∞—Å–∞</button>
            <button class="time-filter-btn" data-period="7d">7 –¥–Ω–µ–π</button>
            <button class="time-filter-btn" data-period="30d">30 –¥–Ω–µ–π</button>
        </div>

        <input type="text" class="search-box" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." id="searchBox" onkeyup="searchGifts()">

        <button class="filter-btn active" data-sort="price">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ</button>
        <button class="filter-btn" data-sort="volume">–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É</button>
        <button class="filter-btn" data-sort="name">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</button>
        <button class="filter-btn" data-sort="change">–ü–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é</button>

        <button class="refresh-btn" onclick="loadData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <div class="container">
        <div class="analytics-summary" id="analyticsSummary" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="totalCollections">0</div>
                <div class="stat-label">–ö–æ–ª–ª–µ–∫—Ü–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalModels">0</div>
                <div class="stat-label">–ú–æ–¥–µ–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgPrice">0</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="topGainer">-</div>
                <div class="stat-label">–õ—É—á—à–∏–π —Ä–æ—Å—Ç</div>
            </div>
        </div>

        <button class="back-btn" onclick="showCollections()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º</button>

        <div id="collections-view">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>

        <div id="models-view" style="display: none;">
            <div class="models-list"></div>
        </div>
    </div>

    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="currentPrice">0</div>
                    <div class="stat-label">–¶–µ–Ω–∞ (TON)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="priceWithCommission">0</div>
                    <div class="stat-label">–° –∫–æ–º–∏—Å—Å–∏–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="volume">0</div>
                    <div class="stat-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="changePeriodValue">0%</div>
                    <div class="stat-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ (<span id="modalPeriodLabel">24—á</span>)</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let giftsData = null;
        let currentView = 'collections';
        let currentCollection = null;
        let currentPeriod = '1h'; // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
        let currentSort = 'price'; // –î–µ—Ñ–æ–ª—Ç–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        let currentChart = null; // –î–ª—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ Chart.js

        // –°–ª–æ–≤–∞—Ä—å —ç–º–æ–¥–∑–∏ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π
        const collectionEmojis = {
            'Star': '‚≠ê',
            'Moon': 'üåô',
            'Sun': '‚òÄÔ∏è',
            'Heart': '‚ù§Ô∏è',
            'Gift': '',
            'Diamond': 'üíé',
            'Fire': 'üî•',
            'Ice': 'üßä',
            'Thunder': '‚ö°',
            'Roseeeeeeeeeeee': 'üåπ',
            'default': ''
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();

            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(loadData, 30000);
        });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –§–∏–ª—å—Ç—Ä—ã –≤—Ä–µ–º–µ–Ω–∏
            document.querySelectorAll('.time-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.time-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.dataset.period;
                    document.getElementById('modalPeriodLabel').textContent = getPeriodLabel(currentPeriod); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–∏–æ–¥ –≤ –º–æ–¥–∞–ª–∫–µ
                    updateView();
                    updateAnalyticsSummary(); // –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–µ—Ä–∏–æ–¥–∞
                });
            });

            // –§–∏–ª—å—Ç—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentSort = this.dataset.sort;
                    updateView();
                });
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
            window.onclick = function(event) {
                const modal = document.getElementById('statsModal');
                if (event.target == modal) {
                    closeModal();
                }
            };
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        async function loadData() {
            try {
                // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                document.getElementById('collections-view').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>';
                document.getElementById('analyticsSummary').style.display = 'none'; // –°–∫—Ä—ã—Ç—å –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
                const response = await fetch('/api/gifts-data');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                giftsData = await response.json();

                updateLastUpdate();
                updateAnalyticsSummary();
                updateView(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

                console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                console.log('–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ');
                giftsData = generateMockData();

                document.getElementById('collections-view').innerHTML = '<div class="error-message">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</div><div class="collections-grid"></div>';

                updateLastUpdate();
                updateAnalyticsSummary();
                updateView();
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏, —É–¥–∞–ª–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
        function generateMockData() {
            const collections = ['Star', 'Moon', 'Sun', 'Heart', 'Diamond'];
            const models = ['Basic', 'Premium', 'Limited', 'Rare', 'Epic'];

            const data = {
                metadata: {
                    last_update: new Date().toISOString(),
                    data_range_hours: 720,
                    total_records: 0 // –ë—É–¥–µ—Ç –ø–æ–¥—Å—á–∏—Ç–∞–Ω–æ –Ω–∏–∂–µ
                },
                collections: {}
            };
            let totalModelsCount = 0;

            collections.forEach(collection => {
                const collectionModels = {};
                let collectionFloorPriceSum = 0; // –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

                models.forEach(model => {
                    const basePrice = parseFloat((Math.random() * 100 + 10).toFixed(2));
                    const quantity = Math.floor(Math.random() * 1000) + 1;

                    const history = [];
                    const now = new Date();

                    for (let i = 720; i >= 0; i -= 1) { // –ò—Å—Ç–æ—Ä–∏—è –∑–∞ 30 –¥–Ω–µ–π (720 —á–∞—Å–æ–≤)
                        const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                        const priceVariation = (Math.random() - 0.5) * 0.2; // +/- 10%
                        const price = parseFloat(Math.max(1, basePrice * (1 + priceVariation)).toFixed(2));

                        history.push({
                            time: time.toISOString(),
                            price: price,
                            priceWithCommission: parseFloat((price * 1.1).toFixed(2)),
                            quantity: quantity + Math.floor((Math.random() - 0.5) * 100)
                        });
                    }

                    const current = history[history.length - 1];
                    const changes = {};

                    const periods = {
                        '1h': 1,
                        '24h': 24,
                        '7d': 168,
                        '30d': 720
                    };

                    Object.entries(periods).forEach(([period, hours]) => {
                        // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –µ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
                        const pastIndex = Math.max(0, history.length - hours - 1);
                        const pastEntry = history[pastIndex];
                        const currentPrice = current.price;

                        let change = 0;
                        if (pastEntry && pastEntry.price > 0) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ pastEntry —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ü–µ–Ω–∞ –±–æ–ª—å—à–µ 0
                            change = ((currentPrice - pastEntry.price) / pastEntry.price) * 100;
                        }
                        changes[period] = parseFloat(change.toFixed(2));
                    });

                    collectionModels[model] = {
                        model_image_url: `https://via.placeholder.com/80/0096ff/FFFFFF?text=${model.charAt(0)}`, // –ü—Ä–∏–º–µ—Ä –∑–∞–≥–ª—É—à–∫–∏
                        current: {
                            floorPrice: current.price,
                            priceWithComission: current.priceWithCommission,
                            howMany: current.quantity,
                            lastUpdate: current.time
                        },
                        changes: changes,
                        history: history
                    };
                    collectionFloorPriceSum += current.price; // –°—É–º–º–∏—Ä—É–µ–º –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏
                    totalModelsCount++; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±—â–∏–π —Å—á–µ—Ç—á–∏–∫ –º–æ–¥–µ–ª–µ–π
                });
                // –î–æ–±–∞–≤–ª—è–µ–º collection_image_url –∏ collection_floorPrice –≤ –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                data.collections[collection] = {
                    collection_image_url: `https://via.placeholder.com/80/0096ff/FFFFFF?text=${collection.charAt(0)}`, // –ü—Ä–∏–º–µ—Ä –∑–∞–≥–ª—É—à–∫–∏
                    collection_floorPrice: parseFloat((collectionFloorPriceSum / models.length).toFixed(2)), // –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ –º–æ–¥–µ–ª—è–º –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
                    models: collectionModels
                };
            });
            data.metadata.total_records = totalModelsCount; // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π

            return data;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        function updateLastUpdate() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ giftsData –∏ metadata
            if (giftsData && giftsData.metadata && giftsData.metadata.last_update) {
                const lastUpdate = new Date(giftsData.metadata.last_update);
                const formatted = lastUpdate.toLocaleString('ru-RU', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit', second: '2-digit'
                });
                document.getElementById('lastUpdate').textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${formatted}`;
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π
                document.getElementById('totalModelsCount').textContent = `–í—Å–µ–≥–æ –º–æ–¥–µ–ª–µ–π: ${giftsData.metadata.total_records || 0}`;
            } else {
                document.getElementById('lastUpdate').textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö`;
                document.getElementById('totalModelsCount').textContent = `–í—Å–µ–≥–æ –º–æ–¥–µ–ª–µ–π: 0`;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–¥–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function updateAnalyticsSummary() {
            if (!giftsData || !giftsData.collections) {
                document.getElementById('analyticsSummary').style.display = 'none';
                return;
            }

            const collections = Object.keys(giftsData.collections);
            let totalModelsCount = 0;
            let totalPriceSum = 0;
            let maxChange = -Infinity;
            let topGainer = '-';
            let gainerCollection = '';
            let gainerModel = '';

            collections.forEach(collectionName => {
                const collectionObj = giftsData.collections[collectionName];
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ collectionObj –∏ collectionObj.models —Å—É—â–µ—Å—Ç–≤—É—é—Ç
                if (!collectionObj || !collectionObj.models) {
                    return;
                }
                const models = Object.keys(collectionObj.models);
                totalModelsCount += models.length;

                models.forEach(modelName => {
                    const modelData = collectionObj.models[modelName];
                    // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ floorPrice –∏ changes
                    const floorPrice = modelData?.current?.floorPrice ?? 0;
                    totalPriceSum += floorPrice;

                    const change = modelData?.changes?.[currentPeriod] ?? 0; // –ò—Å–ø–æ–ª—å–∑—É–µ–º optional chaining –∏ nullish coalescing
                    if (change > maxChange) {
                        maxChange = change;
                        gainerCollection = collectionName;
                        gainerModel = modelName;
                    }
                });
            });

            const avgPrice = totalModelsCount > 0 ? (totalPriceSum / totalModelsCount).toFixed(2) : '0.00';
            topGainer = maxChange > -Infinity && maxChange !== 0 ? `${gainerCollection} ${gainerModel}` : '-';

            document.getElementById('totalCollections').textContent = collections.length;
            document.getElementById('totalModels').textContent = totalModelsCount;
            document.getElementById('avgPrice').textContent = `${avgPrice} TON`;

            const topGainerElement = document.getElementById('topGainer');
            if (maxChange > -Infinity && maxChange !== 0) {
                topGainerElement.textContent = `${topGainer} (${maxChange > 0 ? '+' : ''}${maxChange.toFixed(1)}%)`;
                topGainerElement.classList.remove('negative', 'neutral');
                topGainerElement.classList.add(maxChange > 0 ? 'positive' : 'negative');
            } else {
                topGainerElement.textContent = '-';
                topGainerElement.classList.remove('positive', 'negative');
                topGainerElement.classList.add('neutral');
            }

            document.getElementById('analyticsSummary').style.display = 'grid'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        function updateView() {
            if (currentView === 'collections') {
                showCollections();
            } else if (currentView === 'models') {
                showModels(currentCollection);
            }
        }

        // –ü–æ–∫–∞–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        function showCollections() {
            currentView = 'collections';
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π collections-grid –∏ –æ—á–∏—â–∞–µ–º –µ–≥–æ
            document.getElementById('collections-view').style.display = 'block';
            document.getElementById('models-view').style.display = 'none';
            document.querySelector('.back-btn').style.display = 'none';

            if (!giftsData || !giftsData.collections || Object.keys(giftsData.collections).length === 0) {
                document.getElementById('collections-view').innerHTML = '<div class="loading">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–π.</div>';
                return;
            }

            const collections = Object.keys(giftsData.collections);
            const collectionsData = collections.map(collectionName => {
                const collectionObj = giftsData.collections[collectionName];
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ collectionObj –∏ collectionObj.models —Å—É—â–µ—Å—Ç–≤—É—é—Ç
                if (!collectionObj || !collectionObj.models) {
                    return { // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞
                        name: collectionName, avgPrice: 0, change: 0, volume: 0, modelsCount: 0
                    };
                }

                const models = Object.keys(collectionObj.models);
                let avgPrice = 0;
                let totalChange = 0;
                let totalVolume = 0;

                models.forEach(modelName => {
                    const modelData = collectionObj.models[modelName];
                    // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø
                    avgPrice += modelData?.current?.floorPrice ?? 0;
                    totalChange += modelData?.changes?.[currentPeriod] ?? 0;
                    totalVolume += modelData?.current?.howMany ?? 0;
                });

                avgPrice = models.length > 0 ? avgPrice / models.length : 0;
                totalChange = models.length > 0 ? totalChange / models.length : 0;

                return {
                    name: collectionName,
                    avgPrice: avgPrice,
                    change: totalChange,
                    volume: totalVolume,
                    modelsCount: models.length
                };
            }).filter(col => col.modelsCount > 0); // –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –±–µ–∑ –º–æ–¥–µ–ª–µ–π –∏–ª–∏ —Å –æ—à–∏–±–∫–∞–º–∏

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            sortCollections(collectionsData);

            // –ü–æ–∏—Å–∫
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const filteredData = collectionsData.filter(collection =>
                collection.name.toLowerCase().includes(searchTerm)
            );

            renderCollections(filteredData);
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        function sortCollections(data) {
            switch (currentSort) {
                case 'price':
                    data.sort((a, b) => b.avgPrice - a.avgPrice);
                    break;
                case 'volume':
                    data.sort((a, b) => b.volume - a.volume);
                    break;
                case 'name':
                    data.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'change':
                    data.sort((a, b) => b.change - a.change);
                    break;
            }
        }


        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
    function renderCollections(collections) {
        // collections-view —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç .collections-grid, –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º –∏ –Ω–∞–ø–æ–ª–Ω—è–µ–º –µ–≥–æ
        let collectionsGrid = document.getElementById('collections-view').querySelector('.collections-grid');
        if (!collectionsGrid) { // –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ)
            collectionsGrid = document.createElement('div');
            collectionsGrid.className = 'collections-grid';
            document.getElementById('collections-view').appendChild(collectionsGrid);
        }
        collectionsGrid.innerHTML = ''; // –û—á–∏—â–∞–µ–º –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º

        if (collections.length === 0) {
            collectionsGrid.innerHTML = '<div class="loading">–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∞—à–µ–º—É –ø–æ–∏—Å–∫—É.</div>';
        } else {
            collections.forEach(collection => {
                const emoji = collectionEmojis[collection.name] || collectionEmojis.default;
                const changeClass = collection.change > 0 ? 'positive' :
                                    collection.change < 0 ? 'negative' : 'neutral';
                const changeSymbol = collection.change > 0 ? '‚Üó' :
                                    collection.change < 0 ? '‚Üò' : '‚Üí';
                const displayChange = Math.abs(collection.change).toFixed(1);

                // 1. –î–û–ë–ê–í–õ–ï–ù–ê –≠–¢–ê –°–¢–†–û–ö–ê: –ü–æ–ª—É—á–∞–µ–º URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏
                const collectionImageUrl = giftsData.collections[collection.name]?.collection_image_url || 'https://via.placeholder.com/48/0096ff/FFFFFF?text=üéÅ';

                const cardHtml = `
                    <div class="collection-card" onclick="showModels(&quot;${collection.name.replace(/"/g, '&quot;')}&quot;)">
                        <div class="collection-header">
                            <img src="${collectionImageUrl}" alt="${collection.name}" class="collection-image">
                            <div class="collection-emoji">${emoji}</div>
                            <div class="collection-name">${collection.name}</div>
                        </div>
                        <div class="collection-stats">
                            <div class="price">${collection.avgPrice.toFixed(2)} TON</div>
                            <div class="change ${changeClass}">
                                ${changeSymbol} ${displayChange}%
                            </div>
                        </div>
                        <div class="model-stats">
                            <span>–ú–æ–¥–µ–ª–µ–π: ${collection.modelsCount}</span>
                            <span>–û–±—ä–µ–º: ${collection.volume}</span>
                        </div>
                        <div class="time-period-label">–∑–∞ ${getPeriodLabel(currentPeriod)}</div>
                    </div>
                `;
                collectionsGrid.insertAdjacentHTML('beforeend', cardHtml);
            });
        }
    }

        // –ü–æ–∫–∞–∑ –º–æ–¥–µ–ª–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function showModels(collectionName) {
            currentView = 'models';
            currentCollection = collectionName;

            document.getElementById('collections-view').style.display = 'none';
            document.getElementById('models-view').style.display = 'block';
            document.querySelector('.back-btn').style.display = 'block';

            if (!giftsData || !giftsData.collections || !giftsData.collections[collectionName] || !giftsData.collections[collectionName].models) {
                document.getElementById('models-view').querySelector('.models-list').innerHTML = '<div class="loading">–î–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–æ–¥–µ–ª–∏.</div>';
                return;
            }

            const models = Object.keys(giftsData.collections[collectionName].models);
            const modelsData = models.map(modelName => {
                const modelData = giftsData.collections[collectionName].models[modelName];
                // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
                return {
                    name: modelName,
                    collection: collectionName,
                    price: modelData?.current?.floorPrice ?? 0,
                    priceWithCommission: modelData?.current?.priceWithComission ?? 0,
                    quantity: modelData?.current?.howMany ?? 0,
                    change: modelData?.changes?.[currentPeriod] ?? 0,
                    data: modelData // –ü–µ—Ä–µ–¥–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                };
            });

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–æ–¥–µ–ª–µ–π
            sortModels(modelsData);

            // –ü–æ–∏—Å–∫
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const filteredData = modelsData.filter(model =>
                model.name.toLowerCase().includes(searchTerm)
            );

            renderModels(filteredData);
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–æ–¥–µ–ª–µ–π
        function sortModels(data) {
            switch (currentSort) {
                case 'price':
                    data.sort((a, b) => b.price - a.price);
                    break;
                case 'volume':
                    data.sort((a, b) => b.quantity - a.quantity);
                    break;
                case 'name':
                    data.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'change':
                    data.sort((a, b) => b.change - a.change);
                    break;
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–æ–¥–µ–ª–µ–π
        function renderModels(models) {
            const modelsList = document.getElementById('models-view').querySelector('.models-list');
            modelsList.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π

            if (models.length === 0) {
                modelsList.innerHTML = '<div class="loading">–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∞—à–µ–º—É –ø–æ–∏—Å–∫—É.</div>';
                return;
            }

            models.forEach(model => {
                const changeClass = model.change > 0 ? 'positive' :
                                    model.change < 0 ? 'negative' : 'neutral';
                const changeSymbol = model.change > 0 ? '‚Üó' :
                                    model.change < 0 ? '‚Üò' : '‚Üí';
                const displayChange = Math.abs(model.change).toFixed(1);

                // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ model_image_url
                const imageUrl = model.data?.model_image_url || 'https://via.placeholder.com/80/0096ff/FFFFFF?text=Gift'; // –ó–∞–≥–ª—É—à–∫–∞, –µ—Å–ª–∏ –Ω–µ—Ç URL
                const imageHtml = `<img src="${imageUrl}" alt="${model.name}" class="model-image">`;

                const modelCard = document.createElement('div');
                modelCard.className = 'model-card';
                modelCard.innerHTML = `
                    ${imageHtml}
                    <div class="model-header">
                        <div class="model-name">${model.name}</div>
                        <div class="price">${model.price.toFixed(2)} TON</div>
                    </div>
                    <div class="model-stats">
                        <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${model.quantity}</span>
                        <span class="change ${changeClass}">
                            ${changeSymbol} ${displayChange}%
                        </span>
                    </div>
                    <div class="time-period-label">–∑–∞ ${getPeriodLabel(currentPeriod)}</div>
                `;
                modelCard.onclick = () => openModal(model.data, model.name); // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                modelsList.appendChild(modelCard);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ (–æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ)
        function searchGifts() {
            updateView();
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function openModal(modelData, modelName) {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–∏–æ–¥ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.getElementById('modalPeriodLabel').textContent = getPeriodLabel(currentPeriod);

            document.getElementById('modalTitle').textContent = `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${currentCollection || 'N/A'} ${modelName}`;
            // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –º–æ–¥–µ–ª–∏
            document.getElementById('currentPrice').textContent = `${(modelData?.current?.floorPrice ?? 0).toFixed(2)} TON`;
            document.getElementById('priceWithCommission').textContent = `${(modelData?.current?.priceWithComission ?? 0).toFixed(2)} TON`;
            document.getElementById('volume').textContent = modelData?.current?.howMany ?? 0;

            const changeVal = modelData?.changes?.[currentPeriod] ?? 0;
            const changeClass = changeVal > 0 ? 'positive' : (changeVal < 0 ? 'negative' : 'neutral');
            const changeSymbol = changeVal > 0 ? '+' : '';
            const changeElement = document.getElementById('changePeriodValue');
            changeElement.className = `stat-value ${changeClass}`; /* –û–±–Ω–æ–≤–ª–µ–Ω –∫–ª–∞—Å—Å */
            changeElement.textContent = `${changeSymbol}${changeVal.toFixed(1)}%`;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ historyData —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º
            if (modelData?.history && Array.isArray(modelData.history)) {
                updateChart(modelData.history, modelName);
            } else {
                // –ï—Å–ª–∏ history –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
                if (currentChart) {
                    currentChart.destroy();
                    currentChart = null;
                }
                const ctx = document.getElementById('priceChart').getContext('2d');
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                console.warn(`–ò—Å—Ç–æ—Ä–∏—è –¥–ª—è –º–æ–¥–µ–ª–∏ ${modelName} –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞.`);
            }

            document.getElementById('statsModal').style.display = 'flex'; // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 'flex' –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal() {
            document.getElementById('statsModal').style.display = 'none';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ Chart.js
        function updateChart(historyData, modelName) {
            if (currentChart) {
                currentChart.destroy(); // –£–Ω–∏—á—Ç–æ–∂–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫
            }

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ —Ç–µ–∫—É—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É
            let filteredHistory = [];
            const now = new Date();
            let hoursToFilter = 0;
            if (currentPeriod === '1h') hoursToFilter = 1;
            else if (currentPeriod === '24h') hoursToFilter = 24;
            else if (currentPeriod === '7d') hoursToFilter = 168;
            else if (currentPeriod === '30d') hoursToFilter = 720;

            if (hoursToFilter > 0) {
                const cutOffTime = new Date(now.getTime() - hoursToFilter * 60 * 60 * 1000);
                // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ filteredHistory —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–æ—Ç—è –±—ã –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç–æ—á–∫—É, –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞—è
                filteredHistory = historyData.filter(entry => new Date(entry.time) >= cutOffTime);
                if (filteredHistory.length === 0 && historyData.length > 0) {
                    filteredHistory = [historyData[historyData.length - 1]]; // –í–∫–ª—é—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç–æ—á–∫—É, –µ—Å–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö
                }
            } else {
                filteredHistory = historyData; // –ï—Å–ª–∏ –ø–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω, –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é
            }

            // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—É—Å—Ç—ã
            if (filteredHistory.length === 0) {
                const ctx = document.getElementById('priceChart').getContext('2d');
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                return;
            }


            const labels = filteredHistory.map(entry => {
                const date = new Date(entry.time);
                if (currentPeriod === '1h' || currentPeriod === '24h') {
                    return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                } else if (currentPeriod === '7d') {
                    return date.toLocaleDateString('ru-RU', { weekday: 'short', hour: '2-digit' });
                } else { // 30d –∏ –¥—Ä—É–≥–∏–µ
                    return date.toLocaleDateString('ru-RU', { day: '2-digit', month: 'short' });
                }
            });
            const prices = filteredHistory.map(entry => entry.price);

            const ctx = document.getElementById('priceChart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `–¶–µ–Ω–∞ ${modelName} (TON)`,
                        data: prices,
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78, 205, 196, 0.2)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        pointHitRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'white',
                                autoSkip: true,
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞
        function getPeriodLabel(period) {
            switch (period) {
                case '1h': return '1 —á–∞—Å';
                case '24h': return '24 —á–∞—Å–∞';
                case '7d': return '7 –¥–Ω–µ–π';
                case '30d': return '30 –¥–Ω–µ–π';
                default: return '';
            }
        }
    </script>
</body>
</html>